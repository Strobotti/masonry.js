(function(a){a.fn.masonry=function(p){var f=a.extend({startOffset:0,rowMinAspectRatio:3.5,borderWidth:0,borderColor:"#fff"},p);function d(i){return parseInt(a(i).attr("width"))}function e(i){return parseInt(a(i).attr("height"))}a(this).css("line-height",0).css("white-space","nowrap").css("overflow-x","hidden");var j=a(this).find("img");var k=f.startOffset;var o=a(this).innerWidth()-(parseInt(a(this).css("padding-left").replace("px",""))+parseInt(a(this).css("padding-right").replace("px","")));for(;k<j.length;k++){var m=0;var c=0;var g=k-1;var n=1;do{g++;m+=d(j[g]);c=Math.max(c,e(j[g]))}while(m<o&&g<=j.length);n=Math.max(n,g-k);m=0;c=0;g=k-1;do{g++;m+=d(j[g]);c=Math.max(c,e(j[g]));n=Math.max(n,g-k)}while(m/c<f.rowMinAspectRatio&&g<j.length);var l=0;for(var h=0;h<n;h++){l+=d(j[k+h])/e(j[k+h])}a(j[k]).parent().css("clear","left");for(h=0;h<n;h++){var b=((d(j[k+h])/e(j[k+h]))/l)*100;a(j[k+h]).css("max-width","99.9%").css("height","auto").css("display","block");a(j[k+h]).css("border-top",Math.round(f.borderWidth/2)+"px");a(j[k+h]).css("border-right",Math.round(f.borderWidth)+"px");a(j[k+h]).css("border-bottom",Math.round(f.borderWidth/2)+"px");a(j[k+h]).css("border-left",Math.round(f.borderWidth)+"px");a(j[k+h]).css("border-color",f.borderColor).css("border-style","solid");b=Math.floor(b*100)/100;a(j[k+h]).parent().css("width",b+"%").css("float","left").css("display","block")}k+=(n-1)}return this}}(jQuery));